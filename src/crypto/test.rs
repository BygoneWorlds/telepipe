
use super::*;

static EXPECTED: &'static [u32] = &[3509856852, 1864700964, 3104392609, 269655757, 3024482305, 2834590675,
    1952967385, 1598259104, 1890537411, 1296614493, 730202663, 1925951155, 3169628017, 1723635568,
    291841835, 563347884, 4279815473, 1984275927, 3256059262, 2374963843, 2155366368, 2983060118,
    4208146543, 4008261814, 38970566, 3564737251, 3448796589, 2248978854, 3120169727, 3208733446,
    3123606318, 3535434370, 2963698881, 202822674, 2344059046, 918613735, 3848784911, 3986958249,
    2328214180, 3874311351, 1120327761, 3058054603, 465736661, 3148730379, 699938717, 2242788899,
    1537120855, 3579190104, 1908967760, 3357942144, 1473168430, 2952799225, 13978260, 2335220632,
    1191979292, 907858336, 1916526406, 355256639, 4084843329, 2438733050, 4033887871, 4209726391,
    1723740230, 3121683262, 4179684631, 982654756, 3795790194, 3436244962, 1599262670, 2876797054,
    317960171, 2665826632, 987665934, 1039294257, 2769001584, 2639757450, 3626483445, 2731339074,
    3749058166, 3348236364, 2424321169, 3387578231, 764025613, 1540685279, 4164196211, 2148346280,
    1409791587, 1176207442, 3637626351, 2587912358, 2703495615, 3819240333, 3382270288, 416432795,
    3543032814, 3686558626, 4114374451, 2471888964, 1323045705, 361295510, 2705095141, 2888912973,
    1966532142, 2645386876, 1551672211, 1782369077, 253287050, 3049005319, 3383064663, 502741708,
    1490915920, 2895445238, 1494905359, 2964588169, 1412919496, 1060214638, 1002392553, 4048540929,
    2382365455, 156291448, 3738018908, 3407891675, 548343802, 3768262989, 2779401218, 1852319013,
    1157517011, 756253189, 3505669121, 1143051327, 2680670021, 1155647872, 1180077529, 3062713792,
    1673010468, 3055760890, 3029836166, 2882441764, 4059385453, 2374868312, 3058185267, 3447159726,
    3583500839, 1668715439, 3157930343, 509860250, 2365291479, 2543106919, 1752208348, 1203507385,
    461192637, 3861346110, 3466855691, 4262028631, 1033096787, 2303277491, 3155890600, 292265103,
    3505801643, 4202748420, 3686670353, 254344335, 3328267922, 1628279095, 1520592867, 2752544362,
    585098933, 1178165038, 786721285, 4027871275, 2912120267, 45721088, 2504872641, 2540807414,
    597244423, 2238387086, 1257100630, 4030551323, 570648193, 2449538694, 2635086855, 1598131400,
    996629085, 3936596344, 3265662410, 3823328851, 3018304051, 1758856067, 3037676634, 2907419463,
    1226404070, 3314242376, 3181377895, 1177976783, 3948342070, 3887722713, 3925780070, 3383047814,
    205888082, 1558977577, 1212813795, 3114880944, 1640949123, 2685986304, 2685903450, 2371621149,
    3745622665, 3091201221, 2878526568, 2388449125, 1666537819, 1046651058, 724476854, 835345301,
    4218876391, 727945911, 3342684391, 33025327, 4267109829, 2174312829, 3549749007, 760166555,
    3867452689, 2444974548, 2217315772, 2784320217, 916456322, 138584880, 1877737606, 3542506259,
    2773527284, 548616259, 4270745764, 1400472971, 1764714574, 2981497139, 3617773116, 913174183,
    1189970116, 4171488276, 2084077666, 2738202233, 1070252275, 1225157363, 2203635479, 918510241,
    2576793717, 2748861501, 3602379310, 4196357143, 2007475698, 3013190513, 3903807573, 150461721,
    1011983483, 25905231, 3645799462, 1578765544, 3993104297, 1125129457, 4181777494, 3463156719,
    214433905, 1943778794, 2031450084, 1467178122, 1514154699, 1966767042, 66780926, 509233503,
    2115320446, 3832316348, 848960339, 2331536249, 1772544472, 1966666777, 902466861, 1658900583,
    1364320310, 1777543845, 2364706546, 1088561152, 684584866, 1688272600, 3829406734, 2585633752,
    4026707621, 1567502105, 4075880248, 3002962245, 2666111319, 3676907916, 3174875561, 1725044990,
    2855361962, 1090763178, 1804076920, 194205697, 1128948752, 25782448, 3458634199, 1198282935,
    3547341128, 3530358236, 883221549, 866191786, 3105345013, 3006328137, 1539213698, 1529700313,
    3085251155, 1629175794, 208858685, 3601896846, 1752000565, 2959871797, 920554490, 4270293158,
    3929823304, 833197492, 938741472, 264361209, 968223604, 342549332, 3699572846, 4172563359,
    2983626565, 1791463348, 2964677001, 1946547207, 2011733042, 1854182151, 3982104829, 2480773211,
    1659177825, 4055473105, 1753171195, 71756992, 1001153212, 2504558808, 3044617684, 2660016366,
    3919779723, 262006598, 456938876, 274354947, 4192021080, 1217319911, 1473173298, 3079977440,
    3254486402, 4282523219, 691886760, 2197534312, 1230492884, 3701431308, 627470808, 921358646,
    1380566717, 4082377211, 4050154631, 1295132548, 1894714844, 1633803835, 2200897801, 4164661481,
    2948922905, 2138301774, 1459383852, 2935989382, 1308038490, 4024844390, 1865585884, 1058638671,
    1730772434, 2390812706, 4094249490, 3337244196, 1385355859, 1182469080, 1237325769, 1741616331,
    3124884340, 4924954, 4065000509, 2027195916, 3136469220, 2969788713, 3879336517, 3652477970,
    3853011499, 3085130671, 2677219741, 2365591744, 2768640288, 2141118592, 2821788192, 3668479059,
    1022863485, 2806939114, 1522296606, 3289421264, 1941784636, 2637176869, 3283844866, 2202981813,
    1503637438, 2768604008, 2793568582, 2967575550, 663250871, 1631710607, 1248519047, 4039481693,
    3627550243, 913734601, 4056864677, 4281026417, 3374636679, 1693221472, 4102592618, 3469231343,
    182799923, 757140478, 769278616, 3183650335, 4200469019, 3179023852, 3707308802, 1064040679,
    2202872222, 3913916890, 213881014, 1181526789, 2601980042, 787848154, 2412750546, 658910360,
    1801081483, 3515280766, 4206721361, 2519661820, 2447865676, 4111693072, 1635674890, 3508584454,
    2510688318, 1964409284, 1263562251, 111679165, 316470351, 2730920700, 3193849494, 3858920998,
    1944048164, 408094809, 888041736, 2965409268, 1252522680, 380932008, 3268076706, 2481595556,
    491323368, 3400235816, 801752297, 1251585686, 1578778577, 1179827229, 79585257, 838723434,
    2228946286, 275870286, 2156646645, 1328066425, 2615193768, 1384338872, 1649650994, 2185133855,
    2348595188, 2388118748, 530450485, 4203194019, 1419614578, 307176815, 1517386374, 3867975148,
    4015495298, 1369893580, 3358407225, 721786176, 1961174504, 2137419856, 2830490978, 3859522173,
    4227063547, 1515263779, 1165872860, 3305247933, 1002498247, 1459733656, 2831293308, 680478773,
    3449938071, 2264579664, 3308671710, 2447565868, 26237039, 192817039, 794816501, 526458467,
    2530818366, 166796861, 3899745514, 152217312, 3171118485, 236269734, 2682201194, 3066329415,
    542165563, 2053213645, 1664020275, 0, 0, 0, 0, 0, 0, 0];

#[test]
fn test_create_crypto() {
    let seed = 0;
    let mut cipher = Cipher::new(seed);

    assert_eq!(&cipher.keys[0..128]  , &EXPECTED[0..128]  );
    assert_eq!(&cipher.keys[128..256], &EXPECTED[128..256]);
    assert_eq!(&cipher.keys[256..384], &EXPECTED[256..384]);
    assert_eq!(&cipher.keys[384..512], &EXPECTED[384..512]);
    assert_eq!(&cipher.keys[512..528], &EXPECTED[512..528]);
}

#[test]
fn test_crypto() {
    let seed = 100;
    let mut cipher = Cipher::new(seed);

    let start = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
    let crypted = [48, 2, 229, 196, 176, 81, 47, 211, 140, 154, 167, 109, 190, 135, 5, 51];

    let mut data = start;
    cipher.codec(&mut data).unwrap();
    assert_eq!(&crypted[..], &data[..]);
    cipher = Cipher::new(seed);
    cipher.codec(&mut data).unwrap();
    assert_eq!(&start[..], &data[..]);
}

#[test]
fn test_codec_buffer_size() {
    let seed = 512;
    let mut cipher = Cipher::new(seed);

    assert_eq!(cipher.codec(&mut vec![0; 3]), Err(CodecError::IllegalBufferSize));
    assert_eq!(cipher.codec(&mut Vec::new()), Ok(()));
    assert_eq!(cipher.codec(&mut vec![0; 512]), Ok(()));
}
